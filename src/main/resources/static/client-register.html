<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Регистрация клиента - PsyConnect</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<nav class="navbar">
    <div class="container">
        <div class="logo">
            <i class="fas fa-brain"></i>
            <a href="index.html" style="color: inherit; text-decoration: none;">
                <span>PsyConnect</span>
            </a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="form-container">
        <div id="inviteInfo" style="display: none;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div class="psychologist-info" style="background: #f0f4ff; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <i class="fas fa-user-md" style="font-size: 48px; color: var(--primary-color); margin-bottom: 10px;"></i>
                    <h3 id="psychologistName" style="margin-bottom: 5px;"></h3>
                    <p id="psychologistSpecialization" style="color: var(--gray-600);"></p>
                </div>
                <p style="color: var(--gray-700);">Вы приглашены стать клиентом этого психолога</p>
            </div>
        </div>

        <h1 class="form-title">Регистрация клиента</h1>
        <p class="form-subtitle" style="text-align: center; color: var(--gray-600); margin-bottom: 30px;">
            Для регистрации вам нужна пригласительная ссылка от вашего психолога
        </p>

        <form id="clientForm" onsubmit="registerClient(event)">
            <div class="form-group">
                <label for="inviteToken" class="form-label">Пригласительный токен *</label>
                <input type="text" id="inviteToken" class="form-input" placeholder="Вставьте токен из ссылки" required>
                <div class="form-hint">Токен должен быть в формате: abc123def456...</div>
            </div>

            <div class="form-group">
                <button type="button" class="btn btn-secondary" onclick="validateInvite()" style="width: 100%;">
                    <i class="fas fa-check-circle"></i> Проверить приглашение
                </button>
            </div>

            <div id="clientFormFields" style="display: none;">
                <div class="form-group">
                    <label for="clientPhone" class="form-label">Номер телефона *</label>
                    <input type="tel" id="clientPhone" class="form-input" placeholder="+79991234567" required>
                </div>

                <div class="form-group">
                    <label for="clientOTP" class="form-label">Код из SMS *</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="clientOTP" class="form-input" placeholder="123456" maxlength="6" required>
                        <button type="button" class="btn btn-secondary" onclick="sendClientOTP()">
                            Получить код
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="clientName" class="form-label">Полное имя *</label>
                    <input type="text" id="clientName" class="form-input" placeholder="Иванова Мария Сергеевна" required>
                </div>

                <div class="form-group">
                    <label for="clientAge" class="form-label">Возраст *</label>
                    <input type="number" id="clientAge" class="form-input" placeholder="25" min="1" max="120" required>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="clientAgreeTerms" required>
                        Я согласен с <a href="#">пользовательским соглашением</a> *
                    </label>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> Зарегистрироваться как клиент
                    </button>
                </div>
            </div>
        </form>

        <div class="form-footer">
            <p>Вы психолог? <a href="psychologist-register.html">Зарегистрируйтесь здесь</a></p>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    // Получить токен из URL, если есть
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('invite');
    if (token) {
        document.getElementById('inviteToken').value = token;
        validateInvite();
    }

    async function validateInvite() {
        const token = document.getElementById('inviteToken').value;

        if (!token) {
            showStatus('Введите пригласительный токен', 'error');
            return;
        }

        showStatus('Проверяем приглашение...', 'info');

        // Заглушка для API
        setTimeout(() => {
            // Мок данные психолога
            document.getElementById('psychologistName').textContent = 'Иванов Иван Иванович';
            document.getElementById('psychologistSpecialization').textContent = 'Клинический психолог, опыт 10 лет';
            document.getElementById('inviteInfo').style.display = 'block';
            document.getElementById('clientFormFields').style.display = 'block';

            showStatus('Приглашение подтверждено! Заполните ваши данные.', 'success');
        }, 1000);
    }

    async function sendClientOTP() {
        const phone = document.getElementById('clientPhone').value;

        if (!phone || !validatePhone(phone)) {
            showStatus('Введите корректный номер телефона', 'error');
            return;
        }

        showStatus('Отправляем код...', 'info');

        // Заглушка для API
        setTimeout(() => {
            showStatus(`Код отправлен на ${phone}. Для теста используйте: 123456`, 'success');
        }, 1000);
    }

    async function registerClient(event) {
        event.preventDefault();

        const phone = document.getElementById('clientPhone').value;
        const otp = document.getElementById('clientOTP').value;
        const fullName = document.getElementById('clientName').value;
        const age = document.getElementById('clientAge').value;
        const token = document.getElementById('inviteToken').value;

        // Валидация
        if (!phone || !validatePhone(phone)) {
            showStatus('Введите корректный номер телефона', 'error');
            return;
        }

        if (!otp || otp.length !== 6) {
            showStatus('Введите 6-значный код из SMS', 'error');
            return;
        }

        if (!fullName) {
            showStatus('Введите ваше имя', 'error');
            return;
        }

        if (!age || age < 1 || age > 120) {
            showStatus('Введите корректный возраст', 'error');
            return;
        }

        showStatus('Регистрируем клиента...', 'info');

        // Заглушка для API
        setTimeout(() => {
            showStatus('Регистрация успешна! Вы стали клиентом психолога.', 'success');

            // Сохранить данные пользователя (заглушка)
            const mockUser = {
                id: 2,
                phone: phone,
                userRole: 'ROLE_CLIENT',
                fullName: fullName,
                age: parseInt(age),
                psychologist: {
                    id: 1,
                    name: 'Иванов Иван Иванович'
                }
            };

            localStorage.setItem('currentUser', JSON.stringify(mockUser));
            localStorage.setItem('accessToken', 'mock_token_client');

            // Перенаправить в ЛК через 2 секунды
            setTimeout(() => {
                window.location.href = 'client-dashboard.html';
            }, 2000);
        }, 1500);
    }
</script>
</body>
</html>