databaseChangeLog:

  - changeSet:
      id: 10
      author: psychology
      changes:
        - createTable:
            tableName: notifications
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_notification_user
                    references: users(id)
                    onDelete: CASCADE
              - column:
                  name: type
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: title
                  type: VARCHAR(200)
              - column:
                  name: message
                  type: TEXT
              - column:
                  name: is_read
                  type: BOOLEAN
                  defaultValueBoolean: false
              - column:
                  name: related_entity_id
                  type: BIGINT
              - column:
                  name: related_entity_type
                  type: VARCHAR(50)
              - column:
                  name: created_at
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP

              - createIndex:
                  tableName: notifications
                  columns:
                    - column:
                        name: user_id
                    - column:
                        name: is_read
                    - column:
                        name: created_at
                  indexName: idx_notifications_user_read

              - createIndex:
                  tableName: notifications
                  columns:
                    - column:
                        name: user_id
                    - column:
                        name: type
                  indexName: idx_notifications_user_type
        - createTable:
            tableName: uploaded_files
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: filename
                  type: VARCHAR(255)
              - column:
                  name: original_name
                  type: VARCHAR(255)
              - column:
                  name: content_type
                  type: VARCHAR(100)
              - column:
                  name: size
                  type: BIGINT
              - column:
                  name: uploaded_by
                  type: BIGINT
                  constraints:
                    foreignKeyName: fk_file_uploaded_by
                    references: users(id)
              - column:
                  name: uploaded_at
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
        - createTable:
            tableName: journal_entries
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: client_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_journal_client
                    references: clients(id)
                    onDelete: CASCADE
              - column:
                  name: content
                  type: TEXT
                  constraints:
                    nullable: false
              - column:
                  name: mood
                  type: VARCHAR(50)
              - column:
                  name: tags
                  type: JSONB
              - column:
                  name: created_at
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: updated_at
                  type: TIMESTAMP

              - createTable:
                  tableName: recommendations
                  columns:
                    - column:
                        name: id
                        type: BIGINT
                        autoIncrement: true
                        constraints:
                          primaryKey: true
                          nullable: false
                    - column:
                        name: psychologist_id
                        type: BIGINT
                        constraints:
                          nullable: false
                          foreignKeyName: fk_recommendation_psychologist
                          references: psychologists(id)
                          onDelete: CASCADE
                    - column:
                        name: client_id
                        type: BIGINT
                        constraints:
                          nullable: false
                          foreignKeyName: fk_recommendation_client
                          references: clients(id)
                          onDelete: CASCADE
                    - column:
                        name: title
                        type: VARCHAR(200)
                        constraints:
                          nullable: false
                    - column:
                        name: content
                        type: TEXT
                        constraints:
                          nullable: false
                    - column:
                        name: deadline
                        type: TIMESTAMP
                    - column:
                        name: priority
                        type: INTEGER
                        defaultValue: 3
                        constraints:
                          nullable: false
                    - column:
                        name: categories
                        type: JSONB
                    - column:
                        name: completed
                        type: BOOLEAN
                        defaultValueBoolean: false
                        constraints:
                          nullable: false
                    - column:
                        name: completed_by_client
                        type: BOOLEAN
                        defaultValueBoolean: false
                    - column:
                        name: completed_at
                        type: TIMESTAMP
                    - column:
                        name: created_at
                        type: TIMESTAMP
                        defaultValueComputed: CURRENT_TIMESTAMP
                    - column:
                        name: updated_at
                        type: TIMESTAMP

              - createIndex:
                  tableName: journal_entries
                  columns:
                    - column:
                        name: client_id
                    - column:
                        name: created_at
                  indexName: idx_journal_client_created

              - createIndex:
                  tableName: recommendations
                  columns:
                    - column:
                        name: client_id
                    - column:
                        name: completed
                    - column:
                        name: deadline
                  indexName: idx_recommendations_client_status

              - createIndex:
                  tableName: recommendations
                  columns:
                    - column:
                        name: psychologist_id
                    - column:
                        name: completed
                  indexName: idx_recommendations_psychologist_status
        - createTable:
            tableName: psychologists
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
                    foreignKeyName: fk_psychologist_user
                    references: users(id)
              - column:
                  name: full_name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: email
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: education
                  type: TEXT
              - column:
                  name: specialization
                  type: VARCHAR(200)
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: photo_url
                  type: VARCHAR(500)
              - column:
                  name: verified
                  type: BOOLEAN
                  defaultValueBoolean: false
              - column:
                  name: verified_at
                  type: TIMESTAMP

        - createTable:
            tableName: clients
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    primaryKey: true
                    nullable: false
                    foreignKeyName: fk_client_user
                    references: users(id)
              - column:
                  name: full_name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: age
                  type: INTEGER
              - column:
                  name: photo_url
                  type: VARCHAR(500)
              - column:
                  name: psychologist_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_client_psychologist
                    references: psychologists(id)
              - column:
                  name: linked_at
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP

        - createTable:
            tableName: invites
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: token
                  type: VARCHAR(100)
                  constraints:
                    unique: true
                    nullable: false
              - column:
                  name: psychologist_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_invite_psychologist
                    references: psychologists(id)
              - column:
                  name: created_at
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
              - column:
                  name: expires_at
                  type: TIMESTAMP
              - column:
                  name: used
                  type: BOOLEAN
                  defaultValueBoolean: false
              - column:
                  name: used_at
                  type: TIMESTAMP

        - createIndex:
            tableName: users
            columns:
              - column:
                  name: phone
            indexName: idx_users_phone

        - createIndex:
            tableName: psychologists
            columns:
              - column:
                  name: email
            indexName: idx_psychologists_email

        - createIndex:
            tableName: invites
            columns:
              - column:
                  name: token
            indexName: idx_invites_token
