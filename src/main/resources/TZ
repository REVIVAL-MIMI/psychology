Техническое задание: Веб-сервис для онлайн-работы психолога с клиентами
1. Общая концепция
Веб-сервис предназначен для безопасного и конфиденциального взаимодействия психолога и его клиентов. Ключевые принципы:

Безопасность: минимизация хранения чувствительных данных, шифрование

Простота: интуитивный интерфейс, минималистичный дизайн

Конфиденциальность: строгое разграничение доступа между клиентами и психологами

Мобильность: адаптивный дизайн для работы с любых устройств

Отличительная особенность регистрации:

Клиент: может зарегистрироваться ТОЛЬКО по пригласительной ссылке от психолога

Психолог: регистрируется самостоятельно по номеру телефона через публичную форму

2. Роли в системе
2.1 Клиент
Пользователь, получивший доступ к платформе исключительно по пригласительной ссылке психолога. После регистрации автоматически привязывается к пригласившему психологу.

2.2 Психолог
Специалист, который самостоятельно регистрируется в системе. Функционал:

Управление клиентами

Назначение сеансов

Ведение рекомендаций и заметок

Общение с клиентами

Ведение дневника наблюдений

3. Регистрация и авторизация
3.1 Общий принцип
В системе отсутствуют логины и пароли

Авторизация осуществляется по номеру телефона + одноразовый код (OTP)

Используется JWT для авторизации и Redis для временных данных

3.2 Регистрация психолога
Процесс регистрации:

Психолог переходит на публичную страницу регистрации

Вводит номер телефона

Получает одноразовый код (4-6 цифр) по SMS (в логах на этапе разработки)

Вводит код для подтверждения

Заполняет расширенный профиль:

ФИО (обязательно)

Контактный email (обязательно)

Образование и квалификация (текстовое поле)

Специализация (выбор из списка или теги)

Краткое описание о себе

Фото (опционально)

Согласие с правилами платформы и этическим кодексом

Профиль отправляется на ручную верификацию администратором

После верификации психолог получает полный доступ к функционалу

3.3 Пригласительные ссылки (для клиентов)
Создание:

Психолог может создавать пригласительные ссылки из своего ЛК

Ссылка содержит уникальный токен

Параметры ссылки:

Одноразовая

Срок действия: 7 дней

Привязана к конкретному психологу

Использование:

Клиент переходит по пригласительной ссылке

Система проверяет валидность токена

Клиенту предлагается ввести номер телефона

Далее процесс аналогичен OTP-авторизации

ВАЖНО: Клиент не может зарегистрироваться без действующей пригласительной ссылки от психолога.

3.4 Вход по номеру телефона
Пользователь вводит номер телефона

Генерируется одноразовый код (4-6 цифр)

Код:

Сохраняется в Redis

TTL: 5 минут

Привязан к номеру телефона

Код отправляется пользователю (на этапе разработки — вывод в логи)

Пользователь вводит код

При успехе:

Создаётся пользователь (если новый)

Создаётся JWT-токен

Пользователь авторизуется в системе

3.5 Защита от перебора OTP
Максимум 3 попытки ввода OTP с одного номера телефона

Блокировка повторной отправки OTP: 1 минута после предыдущей отправки

Автоматическая блокировка номера после 5 неудачных попыток авторизации в течение часа

Rate-limiting: не более 10 запросов авторизации в минуту с одного IP

4. Профили пользователей
4.1 Профиль клиента
После первого входа по пригласительной ссылке клиенту предлагается заполнить профиль:

ФИО (обязательно)

Возраст (обязательно)

Фото (опционально)

После заполнения:

Клиент автоматически привязывается к пригласившему психологу

Попадает в личный кабинет

Получает доступ ко всему функционалу для клиентов

4.2 Профиль психолога
После верификации администратором психолог может:

Редактировать профиль (ФИО, фото, описание, специализация)

Просматривать свой публичный профиль (как его видят клиенты)

Настраивать уведомления

Видеть статистику: количество активных клиентов, проведенных сеансов

5. Функционал клиента
5.1 Главный экран
Информация о психологе (ФИО, фото, специализация)

Ближайший сеанс (дата, время, статус)

Быстрый доступ к чату

Счетчик непрочитанных сообщений

Уведомления о новых событиях

5.2 Чат с психологом
Текстовый чат в реальном времени (WebSocket)

История сообщений

Доступен только между клиентом и его психологом

Поддержка файлов (изображения, PDF) до 5MB

Ограничение длины сообщения: 2000 символов

Звонки: опционально, кнопка может быть реализована как заглушка с описанием "Видеозвонки в разработке" или WebRTC в будущем.

5.3 Расписание сеансов
Список будущих сеансов с возможностью подтверждения

История прошедших сеансов:

Дата и время

Длительность

Статус (проведён / отменён / перенесен)

Уведомления за 24 часа и 1 час до начала сеанса

5.4 Дневник клиента
Клиент может создавать записи:

Дата (автоматически)

Текст (мысли, переживания, события)

Теги/категории (опционально)

Ограничение длины записи: 5000 символов

Записи доступны:

Клиенту (полный доступ)

Его психологу (только просмотр)

Возможность редактирования и удаления записей клиентом

5.5 Рекомендации специалиста
Список рекомендаций от психолога

Рекомендации включают:

Описание

Период действия

Статус (актуальна / завершена)

Клиент видит только актуальные и прошлые рекомендации

Фильтрация по статусу и дате

5.6 Уведомления
Push-уведомления в браузере (при согласии)

Внутрисервисные уведомления

Типы уведомлений:

Новое сообщение в чате

Назначен новый сеанс

Напоминание о сеансе (за 24 часа и 1 час)

Отмена или перенос сеанса

Новая рекомендация от психолога

Напоминание о заполнении дневника (настраивается психологом)

6. Функционал психолога
6.1 Дашборд
Список ближайших сеансов (сегодня/завтра):

Дата и время

Клиент (ФИО, фото)

Статус сеанса

Общее количество клиентов

Статистика за текущий месяц:

Проведено сеансов

Запланировано сеансов

Новые клиенты

Быстрые действия: создать сеанс, написать клиенту

6.2 Управление клиентами
Список всех клиентов с поиском и фильтрацией

Карточка клиента содержит:

Профиль клиента (ФИО, возраст, фото)

Историю сеансов

Дневник клиента (только просмотр)

Рекомендации (история и активные)

Создание пригласительных ссылок для новых клиентов

6.3 Управление сеансами
Статусы сеанса:

Запланирован - сеанс создан, ожидает проведения

Подтвержден - клиент подтвердил участие

В процессе - сеанс начался (для будущей интеграции)

Завершен - сеанс проведен успешно

Отменен - сеанс отменен одной из сторон

Перенесен - сеанс перенесен на другое время

Создание сеанса:

Выбор клиента из списка

Выбор даты и времени

Указание длительности (по умолчанию 50 минут)

Добавление описания/заметок (опционально)

Правила отмены/переноса:

Психолог может отменить или перенести сеанс в любое время

Клиент может отменить сеанс не позднее чем за 12 часов до начала

При отмене сеанса вторая сторона получает уведомление

При переносе создается новая запись о сеансе, старая помечается как "Перенесен"

6.4 Рекомендации
Психолог может:

Добавлять рекомендации клиенту

Редактировать активные рекомендации

Завершать (помечать как неактуальные)

Просматривать историю всех рекомендаций

Шаблоны рекомендаций для быстрого создания

6.5 Чат с клиентами
Единый интерфейс для общения со всеми клиентами

Список диалогов с последними сообщениями

Поиск по истории сообщений

Индикатор непрочитанных сообщений

Возможность прикреплять файлы к сообщениям

6.6 Статистика и отчеты
Количество сеансов за период

Активность клиентов (посещаемость, записи в дневнике)

Общая нагрузка (часов в неделю/месяц)

Экспорт данных в CSV для личного учета

7. Безопасность и ограничения доступа
7.1 Разграничение прав
Клиент имеет доступ только к своим данным

Психолог имеет доступ только к данным своих клиентов

Администратор имеет доступ к верификации психологов и технической поддержке

7.2 Защита данных
JWT для авторизации

Redis для хранения:

OTP кодов

Токенов приглашений

Blacklist токенов

Сессионных данных

Защита от:

Перебора OTP

Повторного использования invite-ссылок

XSS и CSRF атак

7.3 Управление JWT токенами
Access Token: срок жизни 30 минут

Refresh Token: срок жизни 7 дней, хранится в HttpOnly cookie

Механизм обновления:

При истечении Access Token фронтенд использует Refresh Token

Refresh Token одноразовый

При выходе из системы токены попадают в blacklist

Инвалидация всех токенов при смене номера телефона

7.4 Защита персональных данных
Шифрование чувствительных данных (номера телефонов) с использованием AES-256

Автоматическое удаление записей дневника старше 3 лет (настраиваемо)

История чатов хранится 2 года, затем анонимизируется

Экспорт всех пользовательских данных в формате JSON

Полное удаление аккаунта по запросу пользователя (GDPR compliance)

7.5 Rate limiting
100 запросов в минуту на аутентифицированные эндпоинты

10 запросов в минуту на публичные эндпоинты

Отдельные лимиты для OTP и регистрации

8. Технические ограничения и упрощения
Для MVP:
❌ Без платежных систем
❌ Без мобильного приложения (только веб)
❌ Без сложной видеосвязи (WebRTC)
❌ Без групповых сеансов или чатов
❌ Без сложной аналитики и AI-рекомендаций

✅ Акцент на backend-логику, безопасность и роли
✅ Внутренние уведомления (без SMS/email на MVP)
✅ Простой календарь (без выбора слотов, ручной ввод)
✅ Базовый поиск и фильтрация

Технические ограничения:
Максимальный размер файла: 5MB

Максимальное количество клиентов у психолога: 50

Максимальная длина сообщений: 2000 символов

Хранение файлов: локальное или S3-совместимое

9. Технологический стек
Backend:
Java 17+

Spring Boot 3.x

Spring Security с JWT

Spring Data JPA для работы с БД

Spring WebSocket для чата

Redis для кэша, сессий и OTP

PostgreSQL (основная БД) / SQLite (для разработки)

JUnit 5, Mockito для тестирования

Liquibase/Flyway для миграций

Frontend (рекомендуемый):
React 18+ или Vue 3

TypeScript

Vite как сборщик

Tailwind CSS для стилей

Axios для HTTP-запросов

Socket.io-client или STOMP для WebSocket

React Router / Vue Router для навигации

Инфраструктура:
Docker для контейнеризации

Docker Compose для локальной разработки

GitHub Actions / GitLab CI для CI/CD

Nginx как reverse proxy

Let's Encrypt для HTTPS

10. API спецификация
10.1 Общие принципы:
RESTful API с JSON форматом

Версионирование в URL: /api/v1/

Стандартные HTTP коды ответов

Пагинация: limit и offset параметры

Фильтрация и сортировка через query-параметры

10.2 Основные группы эндпоинтов:
/api/v1/auth/** - авторизация, OTP, refresh токенов

/api/v1/profile/** - управление профилями

/api/v1/invites/** - работа с приглашениями (создание, валидация)

/api/v1/sessions/** - управление сеансами

/api/v1/chat/** - REST API для чата + WebSocket

/api/v1/journal/** - дневник клиента

/api/v1/recommendations/** - рекомендации

/api/v1/notifications/** - уведомления

/api/v1/admin/** - администрирование (верификация психологов)

10.3 WebSocket для чата:
Endpoint: /ws/chat

Протокол: STOMP over WebSocket

Авторизация через JWT в query-параметре

Topics:

/user/{userId}/queue/messages - личные сообщения

/topic/notifications - общие уведомления

11. Жизненный цикл данных
11.1 Время хранения:
OTP коды: 5 минут (Redis)

Invite-токены: 7 дней (Redis)

Blacklist токенов: 30 дней (Redis)

Сессионные данные: до 24 часов (Redis)

11.2 Автоматическая архивация:
Завершенные сеансы: через 30 дней → архив

Неактивные диалоги (6+ месяцев): сжатие

Удаленные аккаунты: полное удаление через 30 дней

11.3 Бэкапы:
Ежедневные инкрементальные бэкапы БД

Еженедельные полные бэкапы

Хранение бэкапов 90 дней

12. Разработка и деплой
12.1 Этапы разработки:
Phase 1: Базовая аутентификация + профили

Phase 2: Система приглашений + привязка клиентов

Phase 3: Чат + уведомления

Phase 4: Сеансы + расписание

Phase 5: Дневник + рекомендации

Phase 6: Статистика + админ-панель

12.2 Деплой:
Локальная разработка: Docker Compose

Staging: отдельный сервер/контейнер

Production: облачный хостинг (AWS/GCP) или VPS

12.3 Мониторинг:
Логирование в ELK Stack или аналоги

Мониторинг здоровья эндпоинтов

Трассировка запросов

Метрики производительности

13. Возможности для дальнейшего развития
Высокий приоритет:
SMS-шлюз для реальной отправки OTP

Email-уведомления

WebRTC звонки

Мобильное приложение (React Native/Flutter)

Средний приоритет:
Платежная система для оплаты сеансов

Групповые сеансы

Библиотека материалов (статьи, упражнения)

Система отзывов о психологах

Низкий приоритет:
AI-ассистент для анализа настроения

Интеграция с календарями (Google Calendar, Outlook)

Видеотранскрипция сеансов

Сертификаты и документооборот

14. Ключевые отличия регистрации
Для психолога:
Публичная страница регистрации

Ввод номера телефона → OTP

Заполнение расширенного профиля

Ручная верификация администратором

Полный доступ после верификации

Для клиента:
ТОЛЬКО через пригласительную ссылку психолога

Ввод номера телефона → OTP

Заполнение базового профиля (ФИО, возраст)

Автоматическая привязка к психологу

Немедленный доступ к функционалу


